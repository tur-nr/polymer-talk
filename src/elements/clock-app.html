<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../mixins/redux.html">
<link rel="import" href="../utils/on-second.html">
<link rel="import" href="../mixins/ticker.html">
<link rel="import" href="./clock-face.html">
<link rel="import" href="./clock-time.html">
<link rel="import" href="./clock-date.html">

<dom-module id="clock-app">
	<template>
		<style>
			:host {
				--font: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
			}
		</style>

		<clock-face color="[[background]]">
			<!--
				<clock-time/> push datetime down.
			-->
			<clock-time datetime="[[datetime]]"></clock-time>

			<!--
				<clock-date/> push datetime down.
			-->
			<clock-date datetime="[[datetime]]"></clock-date>

		</clock-face>
	</template>

	<script>
		/** @polymerElement */
		class ClockApp extends ReduxMixin(Polymer.Element) {
			static get is() { return 'clock-app'; }

			static get actions() {
				return {
					startTicker() {
						return dispatch => {
							dispatch({
								type: 'START_TICKER',
								timer: onSecond(() => {
									dispatch('setDatetime', new Date());
								})
							});
						};
					},
					stopTicker() {
						return {
							type: 'STOP_TICKER'
						};
					},
					setDatetime(datetime) {
						return {
							type: 'SET_DATETIME',
							datetime
						};
					}
				};
			}

			static get properties() {
				return {
					datetime: {
						type: Date,
						statePath: 'datetime'
					},
					background: {
						type: String,
						statePath(state) {
							const colors = ['red', 'green', 'blue'];

							return colors[
								Math.floor(state.datetime.getSeconds() / ( 60 / colors.length))
							];
						}
					}
				};
			}

			connectedCallback() {
				super.connectedCallback();

				this.dispatch('startTicker');
			}

			disconnectedCallback() {
				super.disconnectedCallback();

				this.dispatch('stopTicker');
			}
		}

		window.customElements.define(ClockApp.is, ClockApp);
	</script>
</dom-module>
